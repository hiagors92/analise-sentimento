<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise Estratégica de Sentimentos da Clínica</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-01Y53DJM3W"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-01Y53DJM3W');
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 350px;
            width: 100%;
            max-width: 900px;
        }
        .chart-container-sm {
            position: relative;
            margin: auto;
            height: 300px;
            width: 100%;
            max-width: 400px;
        }
        .nav-button {
            transition: all 0.3s ease;
        }
        .nav-button.active {
            background-color: #0d9488; /* teal-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .word-cloud {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 8px 12px;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0d9488;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-800">
    <!-- Chosen Palette: Warm Neutrals (Slate, Teal) -->
    <!-- Application Structure Plan: A single-page dashboard with top navigation to jump between thematic sections: Overview, Sentiment Deep Dive, Temporal Evolution, and Tech Opportunities. This structure guides the user from high-level insights to detailed analysis and actionable solutions, prioritizing usability over mirroring the report's linear format. -->
    <!-- Visualization & Content Choices: Key data is presented with interactive Chart.js charts (Bar, Doughnut, Line) for clarity and engagement. Word clouds are simulated with styled HTML to highlight key terms from patient feedback. The core interaction is a year-selector that dynamically updates the word clouds and summary text, allowing for temporal exploration. Tech opportunities are organized into cards with icons for easy digestion. New LLM feature: Generate a suggested reply to a user-input negative comment, demonstrating AI's role in communication. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <div class="min-h-screen">
        <header class="bg-white shadow-sm sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <h1 class="text-2xl font-bold text-slate-900">Análise Estratégica de Sentimentos</h1>
                <p class="text-slate-500">Um Diagnóstico da Experiência do Paciente para Oportunidades Tecnológicas</p>
            </div>
            <nav class="bg-slate-100">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-center space-x-2 sm:space-x-4 py-2">
                    <a href="#overview" class="nav-link text-sm sm:text-base font-medium text-slate-700 hover:text-teal-600 px-3 py-2 rounded-md">Visão Geral</a>
                    <a href="#sentiment-deep-dive" class="nav-link text-sm sm:text-base font-medium text-slate-700 hover:text-teal-600 px-3 py-2 rounded-md">Análise de Sentimentos</a>
                    <a href="#temporal-evolution" class="nav-link text-sm sm:text-base font-medium text-slate-700 hover:text-teal-600 px-3 py-2 rounded-md">Evolução Temporal</a>
                    <a href="#opportunities" class="nav-link text-sm sm:text-base font-medium text-slate-700 hover:text-teal-600 px-3 py-2 rounded-md">Oportunidades</a>
                </div>
            </nav>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <section id="overview" class="scroll-mt-24 mb-16">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Visão Geral</h2>
                <p class="text-lg text-slate-600 mb-8 max-w-4xl">
                    Uma visão geral dos dados revela uma clínica com uma reputação majoritariamente positiva. A maioria esmagadora dos pacientes está satisfeita, mas uma análise mais profunda dos 16% de comentários negativos aponta para oportunidades críticas de melhoria na operação e comunicação.
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                    <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-md">
                        <h3 class="font-bold text-xl mb-4 text-slate-900">Distribuição de Notas (Ratings)</h3>
                        <div class="chart-container">
                            <canvas id="ratingsChart"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md flex flex-col justify-center">
                        <h3 class="font-bold text-xl mb-4 text-slate-900">Distribuição de Sentimentos</h3>
                        <div class="chart-container-sm">
                            <canvas id="sentimentsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="sentiment-deep-dive" class="scroll-mt-24 mb-16">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Análise de Sentimentos: O Que os Pacientes Dizem</h2>
                <p class="text-lg text-slate-600 mb-8 max-w-4xl">
                    As palavras usadas pelos pacientes pintam um quadro claro. O sentimento positivo é impulsionado pela excelência dos profissionais e resultados, enquanto o negativo se concentra em questões operacionais como agendamento, espera e comunicação.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="font-bold text-xl text-green-600 mb-4">Termos Chave em Comentários Positivos</h3>
                        <div id="positive-word-cloud" class="word-cloud min-h-[250px]"></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="font-bold text-xl text-red-600 mb-4">Termos Chave em Comentários Negativos</h3>
                        <div id="negative-word-cloud" class="word-cloud min-h-[250px]"></div>
                    </div>
                </div>
            </section>
            
            <section id="temporal-evolution" class="scroll-mt-24 mb-16">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Evolução Temporal dos Sentimentos</h2>
                <p class="text-lg text-slate-600 mb-8 max-w-4xl">
                    Explore como a percepção dos pacientes mudou ao longo dos anos. Selecione um ano para ver os principais temas positivos e negativos daquele período. Note o pico de engajamento em 2022, que, embora majoritariamente positivo, manteve os mesmos pontos de atrito negativos.
                </p>
                <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                     <h3 class="font-bold text-xl mb-4 text-slate-900">Evolução dos Comentários (Análise BERT)</h3>
                    <div class="chart-container">
                        <canvas id="evolutionChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex flex-wrap justify-center gap-2 mb-6">
                        <button data-year="geral" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50 active">Geral</button>
                        <button data-year="2025" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2025</button>
                        <button data-year="2024" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2024</button>
                        <button data-year="2023" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2023</button>
                        <button data-year="2022" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2022</button>
                        <button data-year="2021" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2021</button>
                        <button data-year="2020" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2020</button>
                        <button data-year="2019" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2019</button>
                        <button data-year="2018" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2018</button>
                        <button data-year="2017" class="year-btn nav-button px-4 py-2 bg-white border border-slate-300 rounded-full font-semibold text-slate-700 hover:bg-slate-50">2017</button>
                    </div>
                    <div id="temporal-analysis-content" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                         <div class="bg-slate-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg text-green-600 mb-3">Positivo (<span id="positive-year">Geral</span>)</h4>
                            <div id="positive-word-cloud-year" class="word-cloud min-h-[200px]"></div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg text-red-600 mb-3">Negativo (<span id="negative-year">Geral</span>)</h4>
                            <div id="negative-word-cloud-year" class="word-cloud min-h-[200px]"></div>
                            <button id="summarizeNegativeBtn" class="mt-4 px-4 py-2 bg-red-500 text-white font-semibold rounded-md shadow-md hover:bg-red-600 transition-colors">✨ Resumir Pontos de Atenção ✨</button>
                            <div id="negativeSummary" class="mt-4 p-3 bg-red-100 text-red-800 rounded-lg hidden">
                                <p class="font-semibold mb-2">Resumo Gerado:</p>
                                <div id="summaryContent"></div>
                                <div id="summaryLoading" class="loading-spinner mx-auto mt-2"></div>
                            </div>
                            <div class="mt-6 pt-4 border-t border-slate-200">
                                <h4 class="font-bold text-lg text-slate-900 mb-3">Sugerir Resposta para Comentário Negativo</h4>
                                <textarea id="negativeCommentInput" class="w-full p-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500" rows="3" placeholder="Cole um comentário negativo aqui para gerar uma resposta sugerida..."></textarea>
                                <button id="suggestReplyBtn" class="mt-3 px-4 py-2 bg-teal-600 text-white font-semibold rounded-md shadow-md hover:bg-teal-700 transition-colors">✨ Gerar Resposta Sugerida ✨</button>
                                <div id="suggestedReplyOutput" class="mt-4 p-3 bg-blue-100 text-blue-800 rounded-lg hidden">
                                    <p class="font-semibold mb-2">Resposta Sugerida:</p>
                                    <div id="replyContent"></div>
                                    <div id="replyLoading" class="loading-spinner mx-auto mt-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="opportunities" class="scroll-mt-24">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Diagnóstico e Oportunidades Tecnológicas</h2>
                <p class="text-lg text-slate-600 mb-8 max-w-4xl">
                    A análise revela que os pontos de atrito são consistentes e operacionais. A tecnologia pode automatizar e otimizar esses processos, liberando a equipe para focar no atendimento de excelência que já é o grande diferencial da clínica.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex items-center mb-4">
                            <span class="text-4xl mr-4">🗓️</span>
                            <h3 class="font-bold text-xl text-slate-900">Transformação Digital do Agendamento e Fluxo de Pacientes</h3>
                        </div>
                        <ul class="list-disc list-inside text-slate-600 space-y-2">
                            <li>Plataforma Inteligente de Gestão de Consultas (Smart Scheduling & Flow Management)</li>
                            <li>Automação de Lembretes Inteligentes</li>
                            <li>Gestão de Fila em Tempo Real</li>
                            <li>Check-in Digital Otimizado</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex items-center mb-4">
                            <span class="text-4xl mr-4">💬</span>
                            <h3 class="font-bold text-xl text-slate-900">Ecossistema de Comunicação Omnichannel e Engajamento</h3>
                        </div>
                        <ul class="list-disc list-inside text-slate-600 space-y-2">
                            <li>Hub de Comunicação Integrado com Inteligência Artificial (AI-Powered Communication Hub)</li>
                            <li>Chatbot Inteligente 24/7</li>
                            <li>Central de Mensagens Unificada</li>
                            <li>Portal do Paciente Personalizado</li>
                            <li>Campanhas de Engajamento Automatizadas</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex items-center mb-4">
                            <span class="text-4xl mr-4">🏢</span>
                            <h3 class="font-bold text-xl text-slate-900">Análise Preditiva de Sentimentos e Feedback Contínuo</h3>
                        </div>
                        <ul class="list-disc list-inside text-slate-600 space-y-2">
                            <li>Dashboard de Experiência do Paciente com Insights de IA (AI-Powered Patient Experience Dashboard)</li>
                            <li>Coleta Automatizada de Feedback</li>
                            <li>Análise de Sentimentos em Tempo Real</li>
                            <li>Alertas Proativos</li>
                        </ul>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ratingsData = {
                labels: ['Nota 1', 'Nota 2', 'Nota 3', 'Nota 4', 'Nota 5'],
                datasets: [{
                    label: 'Quantidade de Avaliações',
                    data: [68, 10, 10, 10, 395],
                    backgroundColor: [
                        '#ef4444', // red-500
                        '#f97316', // orange-500
                        '#eab308', // yellow-500
                        '#84cc16', // lime-500
                        '#22c55e'  // green-500
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            };

            const sentimentsData = {
                labels: ['Positivo', 'Negativo', 'Neutro'],
                datasets: [{
                    data: [82.4, 15.8, 1.9],
                    backgroundColor: [
                        '#22c55e', // green-500
                        '#ef4444', // red-500
                        '#eab308'  // yellow-500
                    ],
                    hoverOffset: 4
                }]
            };

            const evolutionData = {
                labels: ['2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025'],
                datasets: [
                    {
                        label: 'Positivo',
                        data: [4, 21, 8, 15, 39, 320, 18, 30, 4],
                        borderColor: '#22c55e',
                        backgroundColor: '#22c55e',
                        tension: 0.1
                    },
                    {
                        label: 'Negativo',
                        data: [3, 7, 7, 9, 13, 15, 17, 13, 2],
                        borderColor: '#ef4444',
                        backgroundColor: '#ef4444',
                        tension: 0.1
                    },
                     {
                        label: 'Neutro',
                        data: [4, 8, 1, 2, 1, 32, 4, 2, 0],
                        borderColor: '#eab308',
                        backgroundColor: '#eab308',
                        tension: 0.1
                    }
                ]
            };
            
            const wordCloudData = {
                geral: {
                    positivo: [
                        { text: 'atendimento', weight: 10 }, { text: 'excelente', weight: 9 }, { text: 'profissional', weight: 8 },
                        { text: 'clínica', weight: 8 }, { text: 'procedimento', weight: 7 }, { text: 'sempre', weight: 7 },
                        { text: 'resultado', weight: 6 }, { text: 'amei', weight: 6 }, { text: 'recomendo', weight: 6 },
                        { text: 'super', weight: 5 }, { text: 'fisio', weight: 5 }, { text: 'ótima', weight: 5 },
                        { text: 'maravilhosa', weight: 5 }, { text: 'yara', weight: 4 }, { text: 'eduarda matias', weight: 4 }
                    ],
                    negativo: [
                        { text: 'atendimento', weight: 10 }, { text: 'clínica', weight: 9 }, { text: 'procedimento', weight: 8 },
                        { text: 'hora', weight: 8 }, { text: 'agendamento', weight: 7 }, { text: 'médica', weight: 7 },
                        { text: 'péssimo', weight: 6 }, { text: 'demora', weight: 6 }, { text: 'recepção', weight: 5 },
                        { text: 'contato', weight: 5 }, { text: 'whatsapp', weight: 5 }, { text: 'paguei', weight: 4 },
                        { text: 'atraso', weight: 4 }, { text: 'consulta', weight: 4 }, { text: 'ninguém', weight: 4 }
                    ]
                },
                2025: {
                    positivo: [ { text: 'serviço', weight: 10 }, { text: 'impecável', weight: 9 }, { text: 'atendimento', weight: 8 }, { text: 'começo', weight: 7 }, { text: 'fim', weight: 7 }, { text: 'excelente', weight: 6 }, { text: 'estrutura', weight: 6 }, { text: 'tecnológica', weight: 5 } ],
                    negativo: [ { text: 'demora', weight: 10 }, { text: 'extrema', weight: 9 }, { text: 'lugar', weight: 9 }, { text: 'péssima', weight: 8 }, { text: 'esperando', weight: 7 }, { text: 'atendida', weight: 6 }, { text: 'absurdo', weight: 6 } ]
                },
                2024: {
                    positivo: [ { text: 'atendimento', weight: 10 }, { text: 'maravilhosa', weight: 9 }, { text: 'clínica', weight: 8 }, { text: 'todos', weight: 8 }, { text: 'esteticista', weight: 7 }, { text: 'melhores', weight: 6 }, { text: 'ótima', weight: 6 }, { text: 'show', weight: 5 } ],
                    negativo: [ { text: 'atraso', weight: 10 }, { text: 'atendimento', weight: 9 }, { text: 'recepção', weight: 8 }, { text: 'tempo', weight: 8 }, { text: 'recomendo', weight: 7 }, { text: 'consulta', weight: 7 }, { text: 'hora', weight: 6 }, { text: 'paciente', weight: 6 } ]
                },
                2023: {
                    positivo: [ { text: 'confesso', weight: 10 }, { text: 'hoje', weight: 9 }, { text: 'atendimento', weight: 8 }, { text: 'superando', weight: 7 }, { text: 'atrasos', weight: 7 }, { text: 'todos', weight: 6 } ],
                    negativo: [ { text: 'atendimento', weight: 10 }, { text: 'consulta', weight: 9 }, { text: 'clínica', weight: 8 }, { text: 'pago', weight: 8 }, { text: 'fazer', weight: 7 }, { text: 'laser', weight: 7 }, { text: 'hora', weight: 6 }, { text: 'absurdo', weight: 6 } ]
                },
                2022: {
                    positivo: [ { text: 'atendimento', weight: 10 }, { text: 'excelente', weight: 9 }, { text: 'profissional', weight: 9 }, { text: 'clínica', weight: 8 }, { text: 'procedimento', weight: 8 }, { text: 'atenciosa', weight: 7 }, { text: 'sempre', weight: 7 }, { text: 'yara', weight: 6 }, { text: 'eduarda', weight: 6 } ],
                    negativo: [ { text: 'procedimento', weight: 10 }, { text: 'clínica', weight: 9 }, { text: 'atendimento', weight: 8 }, { text: 'experiência', weight: 7 }, { text: 'sessões', weight: 7 }, { text: 'médica', weight: 6 }, { text: 'contato', weight: 6 }, { text: 'hora', weight: 5 } ]
                },
                2021: {
                    positivo: [ { text: 'atendimento', weight: 10 }, { text: 'excelente', weight: 9 }, { text: 'profissionais', weight: 9 }, { text: 'clínica', weight: 8 }, { text: 'super', weight: 7 }, { text: 'procedimentos', weight: 7 }, { text: 'equipe', weight: 6 } ],
                    negativo: [ { text: 'consulta', weight: 10 }, { text: 'procedimento', weight: 9 }, { text: 'atendimento', weight: 8 }, { text: 'informou', weight: 8 }, { text: 'pacote', weight: 7 }, { text: 'demorou', weight: 6 }, { text: 'médica', weight: 6 } ]
                },
                2020: {
                    positivo: [ { text: 'atendimento', weight: 10 }, { text: 'dra', weight: 9 }, { text: 'gleyce', weight: 9 }, { text: 'anos', weight: 8 }, { text: 'principalmente', weight: 7 }, { text: 'pai', weight: 6 } ],
                    negativo: [ { text: 'tratamento', weight: 10 }, { text: 'consulta', weight: 9 }, { text: 'clínica', weight: 8 }, { text: 'hora', weight: 7 }, { text: 'atendimento', weight: 7 }, { text: 'whatsapp', weight: 6 }, { text: 'recepção', weight: 6 } ]
                },
                2019: {
                    positivo: [ { text: 'tratamento', weight: 10 }, { text: 'procedimentos', weight: 9 }, { text: 'dia', weight: 8 }, { text: 'porque', weight: 7 }, { text: 'médica', weight: 7 } ],
                    negativo: [ { text: 'péssimo', weight: 10 }, { text: 'clínica', weight: 9 }, { text: 'outra', weight: 8 }, { text: 'médica', weight: 7 }, { text: 'estrutura', weight: 6 } ]
                },
                2018: {
                    positivo: [ { text: 'atendimento', weight: 10 }, { text: 'clínica', weight: 9 }, { text: 'procedimento', weight: 8 }, { text: 'sempre', weight: 8 }, { text: 'toda', weight: 7 }, { text: 'pessoa', weight: 7 } ],
                    negativo: [ { text: 'atendimento', weight: 10 }, { text: 'clínica', weight: 9 }, { text: 'hora', weight: 8 }, { text: 'pode', weight: 7 }, { text: 'péssimo', weight: 6 } ]
                },
                2017: {
                    positivo: [],
                    negativo: [ { text: 'infelizmente', weight: 10 }, { text: 'experiência', weight: 9 }, { text: 'médica', weight: 8 }, { text: 'péssima', weight: 7 }, { text: 'clínica', weight: 7 } ]
                }
            };

            let currentYear = 'geral';

            const createChart = (ctx, type, data, options) => new Chart(ctx, { type, data, options });
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: {
                                size: 14,
                                family: 'Inter'
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { font: { family: 'Inter' } }
                    },
                    x: {
                        ticks: { font: { family: 'Inter' } }
                    }
                }
            };
            
            createChart(document.getElementById('ratingsChart').getContext('2d'), 'bar', ratingsData, chartOptions);
            createChart(document.getElementById('sentimentsChart').getContext('2d'), 'doughnut', sentimentsData, { ...chartOptions, scales: {} });
            createChart(document.getElementById('evolutionChart').getContext('2d'), 'line', evolutionData, chartOptions);

            const generateWordCloudHTML = (words) => {
                if (!words || words.length === 0) {
                    return '<p class="text-slate-500">Nenhum dado para exibir.</p>';
                }
                const colors = ['text-slate-900', 'text-teal-700', 'text-slate-700', 'text-teal-600', 'text-slate-600'];
                return words.map((word, index) => {
                    const fontSize = Math.max(1, 2.5 - (word.weight / 4)) + 'rem';
                    const color = colors[index % colors.length];
                    return `<span class="${color} font-bold" style="font-size: ${fontSize};">${word.text}</span>`;
                }).join('');
            };

            const updateWordClouds = (year) => {
                currentYear = year;
                const data = wordCloudData[year];
                if (!data) return;
                
                document.getElementById('positive-word-cloud-year').innerHTML = generateWordCloudHTML(data.positivo);
                document.getElementById('negative-word-cloud-year').innerHTML = generateWordCloudHTML(data.negativo);
                document.getElementById('positive-year').textContent = year;
                document.getElementById('negative-year').textContent = year;
                document.getElementById('negativeSummary').classList.add('hidden'); // Hide summary when year changes
                document.getElementById('summaryContent').innerHTML = ''; // Clear summary content
                document.getElementById('suggestedReplyOutput').classList.add('hidden'); // Hide reply when year changes
                document.getElementById('replyContent').innerHTML = ''; // Clear reply content
                document.getElementById('negativeCommentInput').value = ''; // Clear input field
            };

            document.getElementById('positive-word-cloud').innerHTML = generateWordCloudHTML(wordCloudData.geral.positivo);
            document.getElementById('negative-word-cloud').innerHTML = generateWordCloudHTML(wordCloudData.geral.negativo);
            updateWordClouds('geral');
            
            document.querySelectorAll('.year-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.year-btn').forEach(btn => btn.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    const year = e.currentTarget.dataset.year;
                    updateWordClouds(year);
                });
            });

            document.getElementById('summarizeNegativeBtn').addEventListener('click', async () => {
                const negativeTerms = wordCloudData[currentYear].negativo.map(item => item.text).join(', ');
                const summaryDiv = document.getElementById('negativeSummary');
                const summaryContent = document.getElementById('summaryContent');
                const summaryLoading = document.getElementById('summaryLoading');

                summaryDiv.classList.remove('hidden');
                summaryContent.innerHTML = '';
                summaryLoading.style.display = 'block';

                const prompt = `Gere um resumo conciso dos principais pontos de atenção ou problemas que uma clínica dermatológica pode ter, com base nos seguintes termos-chave de feedback negativo de pacientes: ${negativeTerms}. O resumo deve ser em português e focar em áreas de melhoria.`;
                
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        summaryContent.innerHTML = text;
                    } else {
                        summaryContent.innerHTML = 'Não foi possível gerar o resumo. Tente novamente.';
                    }
                } catch (error) {
                    console.error('Erro ao chamar a API Gemini:', error);
                    summaryContent.innerHTML = 'Ocorreu um erro ao gerar o resumo. Por favor, tente novamente mais tarde.';
                } finally {
                    summaryLoading.style.display = 'none';
                }
            });

            document.getElementById('suggestReplyBtn').addEventListener('click', async () => {
                const negativeComment = document.getElementById('negativeCommentInput').value;
                const replyOutputDiv = document.getElementById('suggestedReplyOutput');
                const replyContent = document.getElementById('replyContent');
                const replyLoading = document.getElementById('replyLoading');

                if (!negativeComment.trim()) {
                    replyContent.innerHTML = 'Por favor, insira um comentário negativo para gerar uma resposta.';
                    replyOutputDiv.classList.remove('hidden');
                    return;
                }

                replyOutputDiv.classList.remove('hidden');
                replyContent.innerHTML = '';
                replyLoading.style.display = 'block';

                const prompt = `Gere uma resposta profissional, empática e orientada para a solução para o seguinte comentário negativo de um cliente de uma clínica dermatológica: "${negativeComment}". A resposta deve ser em português, demonstrar compreensão e convidar a um próximo passo para resolução.`;
                
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        replyContent.innerHTML = text;
                    } else {
                        replyContent.innerHTML = 'Não foi possível gerar a resposta sugerida. Tente novamente.';
                    }
                } catch (error) {
                    console.error('Erro ao chamar a API Gemini:', error);
                    replyContent.innerHTML = 'Ocorreu um erro ao gerar a resposta. Por favor, tente novamente mais tarde.';
                } finally {
                    replyLoading.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
